{"version":3,"file":"auth.js","names":["isAuth","req","res","next","authHeader","get","errorHandling","token","split","decodedToken","jwt","verify","config","jwt_secret","userData","userId","email","error","statusCode","isAdmin","Users","findById","password","user","type","isUser","paramUserId","params","message","code","Error"],"sources":["../../server/helper/auth.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\nimport config from \"../config/config\";\nimport Users from \"../models/users\";\n\nconst isAuth = (req, res, next) => {\n  const authHeader = req.get(\"Authorization\");\n\n  if (!authHeader) {\n    errorHandling(\"Not authorized, Authorization header not found\", 401);\n  }\n\n  try {\n    const token = authHeader.split(\" \")[1];\n    const decodedToken = jwt.verify(token, config.jwt_secret);\n    if (!decodedToken) {\n      errorHandling(\"Token verification failed\", 401);\n    }\n    req.userData = {\n      userId: decodedToken.userId,\n      email: decodedToken.email,\n    };\n    next();\n  } catch (error) {\n    if (!error.statusCode) {\n      error.statusCode = 401;\n    }\n    next(error);\n  }\n};\n\nconst isAdmin = async (req, res, next) => {\n  try {\n    const userId = req.userData.userId;\n    const user = await Users.findById(userId, { password: 0 });\n\n    if (!user) {\n      errorHandling(\"Authentication failed, Could not find user\", 401);\n    }\n\n    if (!(user.type === \"admin\")) {\n      errorHandling(\"Authorization failed, Not admin\", 401);\n    }\n\n    next();\n  } catch (error) {\n    if (!error.statusCode) {\n      error.statusCode = 401;\n    }\n    next(error);\n  }\n};\n\nconst isUser = async (req, res, next) => {\n  try {\n    const userId = req.userData.userId;\n    const paramUserId = req.params.userId;\n\n    const user = await Users.findById(userId, { password: 0 });\n\n    if (!user) {\n      errorHandling(\"Authentication failed, Could not find user\", 401);\n    }\n\n    if (userId !== paramUserId && user.type !== \"admin\") {\n      errorHandling(\n        `Authorization failed, Cannot access another user's data`,\n        401\n      );\n    }\n    next();\n  } catch (error) {\n    if (!error.statusCode) {\n      error.statusCode = 401;\n    }\n    next(error);\n  }\n};\n\nconst errorHandling = (message, code) => {\n  const error = new Error(message);\n  error.statusCode = code;\n  throw error;\n};\n\nexport default {\n  isAuth,\n  isAdmin,\n  isUser,\n};\n"],"mappings":"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"}